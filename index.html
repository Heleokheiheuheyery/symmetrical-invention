<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Game Player</title>
    <meta name="description" content="Game Player (formerly something else we don't talk about). Play games safely if allowed. Some games may not work. DO NOT SHARE. Only during free time or out of school. If you get caught, I WILL SNITCH. Also, if your teacher has GoGuardian pls do not play I am begging you.">
    <style>
        :root {
            --bg-color: #121212;
            --text-color: #e0e0e0;
            --accent-color: #1E88E5;
            --accent-hover: #1565C0;
            --border-color: #333;
            --loading-color: #FF9800;
            --error-color: #FF5252;
        }
        body {
            font-family: 'Segoe UI', sans-serif;
            margin: 0;
            padding: 0;
            text-align: center;
            background: var(--bg-color);
            color: var(--text-color);
        }
        .page {
            display: none;
            padding: 50px 20px;
        }
        .active {
            display: block;
        }
        button {
            font-size: 1.2rem;
            padding: 15px 30px;
            margin: 10px;
            border: none;
            border-radius: 8px;
            background-color: var(--accent-color);
            color: white;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: var(--accent-hover);
        }
        #dropbox {
            border: 3px dashed var(--border-color);
            padding: 50px;
            margin-top: 30px;
            color: #aaa;
            font-size: 1.2em;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        #dropbox.loading::before {
            content: '';
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 10;
        }
        #dropbox.loading::after {
            content: 'Loading...';
            display: block;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--loading-color);
            font-size: 1.5em;
            z-index: 11;
        }
        #video-dropzone {
            border: 3px dashed var(--border-color);
            padding: 50px;
            margin-top: 30px;
            color: #aaa;
            font-size: 1.2em;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        #video-dropzone.loading::before {
            content: '';
            display: block;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 10;
        }
        #video-dropzone.loading::after {
            content: 'Loading...';
            display: block;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--loading-color);
            font-size: 1.5em;
            z-index: 11;
        }
        iframe {
            width: 100%;
            height: 100vh;
            border: none;
            background: var(--bg-color);
        }
        .description {
            font-size: 0.95em;
            margin: 20px auto;
            max-width: 700px;
            color: #bbb;
            padding: 10px;
            line-height: 1.6;
        }
        .warning {
            color: #FF5252;
            font-weight: bold;
            margin-top: 20px;
            font-size: 1.1em;
        }
        #video-container {
            margin-top: 10px;
        }
        video {
            max-width: 80%;
            height: auto;
            border: 1px solid var(--border-color);
        }
        .error-message {
            color: var(--error-color);
            margin-top: 10px;
            font-size: 1em;
            font-weight: bold;
        }
        .status-message {
            color: var(--loading-color);
            margin-top: 10px;
            font-size: 1em;
        }
        .progress-container {
            width: 80%;
            margin: 20px auto;
            background-color: var(--border-color);
            border-radius: 10px;
            height: 20px;
            display: none;
        }
        .progress-bar {
            height: 100%;
            border-radius: 10px;
            background-color: var(--accent-color);
            width: 0%;
            transition: width 0.3s;
        }
    </style>
</head>
<body>

    <div id="home" class="page active">
        <h1>Game Player</h1>
        <div class="description">
            (Formerly something else... <strong>we don't speak about it.</strong>)<br><br>
            A chill place to play games (some may not work).<br><br>
            <strong>DO NOT SHARE THIS LINK.</strong><br><br>
            Only use this during teacher-approved free time or out of school.<br><br>
            <strong>IF YOU GET CAUGHT, I WILL SNITCH ON EVERYONE ðŸ˜‚.</strong><br><br>
            If you don't like snitches, just chill and play games in peace ðŸŽ®.
        </div>
        <div class="warning">
            ðŸš¨ If your teacher has GoGuardian pls do not play I am begging ðŸš¨
        </div>
        <br>
        <button onclick="goTo('drive')">Go to Google Drive</button>
        <button onclick="goTo('player')">Play an HTML File</button>
        <button onclick="goTo('movies')">Button to moovsies</button>
        <button onclick="goTo('video')">Insert video(any video format) here</button>
    </div>

    <div id="drive" class="page">
        <h1>Google Drive Folder</h1>
        <button onclick="openDrive()">Open Drive Folder</button><br><br>
        <button onclick="goTo('home')">Back to Home</button>
    </div>

    <div id="player" class="page">
        <h1>Drag & Play HTML</h1>
        <div id="dropbox" tabindex="0">
            Drag an HTML file here and press Enter<br>
            <span style="font-size: 0.8em; color: #888;">Now supports files over 1GB!</span>
        </div>
        <div class="progress-container" id="html-progress-container">
            <div class="progress-bar" id="html-progress-bar"></div>
        </div>
        <div id="html-status" class="status-message"></div>
        <div id="html-error-message" class="error-message"></div>
        <button onclick="goTo('home')">Back to Home</button>
    </div>

    <div id="movies" class="page">
        <h1>Moovsies</h1>
        <button onclick="openMovies()">Go to Moovsies Folder</button><br><br>
        <button onclick="goTo('home')">Back to Home</button>
    </div>

    <div id="video" class="page">
        <h1>Drag & Play Video</h1>
        <div id="video-dropzone">
            Drag a video file here to play<br>
            <span style="font-size: 0.8em; color: #888;">Now supports files over 1GB!</span>
        </div>
        <div class="progress-container" id="video-progress-container">
            <div class="progress-bar" id="video-progress-bar"></div>
        </div>
        <div id="video-status" class="status-message"></div>
        <div id="video-error-message" class="error-message"></div>
        <div id="video-container" style="display: none;">
            <video id="dropped-video" controls style="width: 80%; max-width: 800px; height: auto; border: 1px solid var(--border-color);"></video>
        </div>
        <button onclick="goTo('home')">Back to Home</button>
    </div>

    <script>
        function goTo(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(page).classList.add('active');
        }

        function openDrive() {
            window.open('https://drive.google.com/drive/folders/1ou3mI5xJVQv8Vt_MvwejPtf7zStSnU-s?usp=sharing', '_blank');
        }

        function openMovies() {
            window.open('https://drive.google.com/drive/folders/1nvLWCEh2eBFoht1f_eX53CjWx7RJtzUG?usp=sharing', '_blank');
        }

        // Updated Drag and Drop logic for HTML player with support for large files
        let fileContent = "";
        const dropbox = document.getElementById('dropbox');
        const htmlErrorMessage = document.getElementById('html-error-message');
        const htmlStatusMessage = document.getElementById('html-status');
        const htmlProgressContainer = document.getElementById('html-progress-container');
        const htmlProgressBar = document.getElementById('html-progress-bar');
        
        
        const MAX_FILE_SIZE_GB = 100;
        const MAX_FILE_SIZE_BYTES = MAX_FILE_SIZE_GB * 1024 * 1024 * 1024;

        dropbox.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropbox.style.borderColor = 'var(--accent-color)';
        });

        dropbox.addEventListener('dragleave', (e) => {
            e.preventDefault();
            dropbox.style.borderColor = 'var(--border-color)';
        });

        dropbox.addEventListener('drop', (e) => {
            e.preventDefault();
            dropbox.style.borderColor = 'var(--border-color)';
            dropbox.classList.add('loading');
            htmlErrorMessage.textContent = '';
            htmlStatusMessage.textContent = '';
            fileContent = ""; // Reset previous content
            htmlProgressContainer.style.display = 'none';
            htmlProgressBar.style.width = '0%';

            const file = e.dataTransfer.files[0];
            if (file) {
                if (file.size > MAX_FILE_SIZE_BYTES) {
                    htmlErrorMessage.textContent = `File is over ${MAX_FILE_SIZE_GB}GB. This may cause browser performance issues.`;
                    // We'll still try to load it, but with a warning
                }
                
                if (file.type === "text/html") {
                    htmlProgressContainer.style.display = 'block';
                    
                    const reader = new FileReader();
                    
                    reader.onprogress = (event) => {
                        if (event.lengthComputable) {
                            const percentLoaded = Math.round((event.loaded / event.total) * 100);
                            htmlProgressBar.style.width = percentLoaded + '%';
                            htmlStatusMessage.textContent = `Loading: ${percentLoaded}%`;
                        }
                    };
                    
                    reader.onload = (e) => {
                        fileContent = e.target.result;
                        dropbox.classList.remove('loading');
                        htmlStatusMessage.textContent = 'File loaded! Press Enter to run.';
                        htmlProgressBar.style.width = '100%';
                        dropbox.focus();
                    };
                    
                    reader.onerror = (error) => {
                        htmlErrorMessage.textContent = `Error reading the HTML file (${error.message})`;
                        dropbox.classList.remove('loading');
                        htmlProgressContainer.style.display = 'none';
                    };
                    
                    reader.readAsText(file);
                } else if (file.type === "text/css") {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const style = document.createElement('style');
                        style.textContent = e.target.result;
                        document.head.appendChild(style);
                        dropbox.classList.remove('loading');
                        htmlStatusMessage.textContent = 'CSS file injected successfully.';
                    };
                    reader.onerror = (error) => {
                        htmlErrorMessage.textContent = `Error reading the CSS file (${error.message})`;
                        dropbox.classList.remove('loading');
                    };
                    reader.readAsText(file);
                } else if (file.type === "text/javascript") {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const script = document.createElement('script');
                        script.textContent = e.target.result;
                        document.body.appendChild(script);
                        dropbox.classList.remove('loading');
                        htmlStatusMessage.textContent = 'JavaScript file injected successfully.';
                    };
                    reader.onerror = (error) => {
                        htmlErrorMessage.textContent = `Error reading the JavaScript file (${error.message})`;
                        dropbox.classList.remove('loading');
                    };
                    reader.readAsText(file);
                } else if (file.type.startsWith('video/')) {
                    htmlStatusMessage.textContent = "This looks like a video file. Try the 'Insert video' section instead.";
                    dropbox.classList.remove('loading');
                } else {
                    htmlErrorMessage.textContent = "That file type isn't directly playable here. Try an HTML file.";
                    dropbox.classList.remove('loading');
                }
            } else {
                dropbox.classList.remove('loading');
            }
        });

        dropbox.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && fileContent) {
                htmlStatusMessage.textContent = 'Loading game...';
                
                // Use setTimeout to allow UI to update before heavy processing
                setTimeout(() => {
                    document.body.innerHTML = '';
                    const iframe = document.createElement('iframe');
                    document.body.appendChild(iframe);

                    const doc = iframe.contentWindow.document;
                    doc.open();
                    doc.write(fileContent);
                    doc.close();
                }, 100);
            }
        });

        // Updated Drag and Drop logic for video player with support for large files
        const videoDropzone = document.getElementById('video-dropzone');
        const videoContainer = document.getElementById('video-container');
        const droppedVideo = document.getElementById('dropped-video');
        const videoErrorMessage = document.getElementById('video-error-message');
        const videoStatusMessage = document.getElementById('video-status');
        const videoProgressContainer = document.getElementById('video-progress-container');
        const videoProgressBar = document.getElementById('video-progress-bar');

        videoDropzone.addEventListener('dragover', (e) => {
            e.preventDefault();
            videoDropzone.style.borderColor = 'var(--accent-color)';
        });

        videoDropzone.addEventListener('dragleave', (e) => {
            e.preventDefault();
            videoDropzone.style.borderColor = 'var(--border-color)';
        });

        videoDropzone.addEventListener('drop', (e) => {
            e.preventDefault();
            videoDropzone.style.borderColor = 'var(--border-color)';
            videoDropzone.classList.add('loading');
            videoErrorMessage.textContent = '';
            videoStatusMessage.textContent = '';
            videoProgressContainer.style.display = 'none';
            videoProgressBar.style.width = '0%';
            videoContainer.style.display = 'none';

            const file = e.dataTransfer.files[0];
            if (file) {
                if (file.size > MAX_FILE_SIZE_BYTES) {
                    videoErrorMessage.textContent = `File is over ${MAX_FILE_SIZE_GB}GB. This may cause browser performance issues.`;
                    // We'll still try to load it, but with a warning
                }
                
                if (file.type.startsWith('video/')) {
                    videoProgressContainer.style.display = 'block';
                    
                    // For video files, we need to use a different approach for large files
                    // Instead of loading the entire file into memory, we create a URL
                    try {
                        const videoURL = URL.createObjectURL(file);
                        droppedVideo.src = videoURL;
                        
                        // Setup video loading tracking
                        droppedVideo.onloadeddata = () => {
                            videoProgressBar.style.width = '100%';
                            videoStatusMessage.textContent = 'Video loaded successfully!';
                            videoContainer.style.display = 'block';
                            videoDropzone.classList.remove('loading');
                        };
                        
                        // Show loading progress
                        droppedVideo.onprogress = (event) => {
                            if (event.lengthComputable) {
                                const percentLoaded = Math.round((event.loaded / event.total) * 100);
                                videoProgressBar.style.width = percentLoaded + '%';
                                videoStatusMessage.textContent = `Loading: ${percentLoaded}%`;
                            } else {
                                // If length is not computable, just show indeterminate progress
                                videoStatusMessage.textContent = 'Loading video...';
                            }
                        };
                        
                        droppedVideo.onerror = (error) => {
                            videoErrorMessage.textContent = `Error loading the video file.`;
                            videoDropzone.classList.remove('loading');
                            videoProgressContainer.style.display = 'none';
                            droppedVideo.src = '';
                        };
                        
                        // Start loading
                        droppedVideo.load();
                    } catch (error) {
                        videoErrorMessage.textContent = `Error processing the video file: ${error.message}`;
                        videoDropzone.classList.remove('loading');
                        videoProgressContainer.style.display = 'none';
                    }
                } else if (file.type === "text/html") {
                    videoErrorMessage.textContent = "This area is for videos! Try the 'Play an HTML File' section.";
                    videoDropzone.classList.remove('loading');
                } else {
                    videoErrorMessage.textContent = "That doesn't look like a video file!";
                    videoDropzone.classList.remove('loading');
                }
            } else {
                videoDropzone.classList.remove('loading');
            }
        });

        // Add file input support as an alternative to drag & drop
        function addFileInputSupport() {
            // For HTML section
            const htmlFileInput = document.createElement('input');
            htmlFileInput.type = 'file';
            htmlFileInput.accept = '.html,.css,.js';
            htmlFileInput.style.display = 'none';
            
            const htmlFileButton = document.createElement('button');
            htmlFileButton.textContent = 'Or Select File';
            htmlFileButton.onclick = (e) => {
                e.preventDefault();
                htmlFileInput.click();
            };
            
            dropbox.parentNode.insertBefore(htmlFileButton, dropbox.nextSibling);
            dropbox.parentNode.insertBefore(htmlFileInput, htmlFileButton.nextSibling);
            
            htmlFileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    // Create a mock drop event
                    const mockDropEvent = {
                        preventDefault: () => {},
                        dataTransfer: {
                            files: [file]
                        }
                    };
                    
                    // Use the existing drop handler
                    dropbox.dispatchEvent(new DragEvent('drop', mockDropEvent));
                }
            });
            
            // For Video section
            const videoFileInput = document.createElement('input');
            videoFileInput.type = 'file';
            videoFileInput.accept = 'video/*';
            videoFileInput.style.display = 'none';
            
            const videoFileButton = document.createElement('button');
            videoFileButton.textContent = 'Or Select Video';
            videoFileButton.onclick = (e) => {
                e.preventDefault();
                videoFileInput.click();
            };
            
            videoDropzone.parentNode.insertBefore(videoFileButton, videoDropzone.nextSibling);
            videoDropzone.parentNode.insertBefore(videoFileInput, videoFileButton.nextSibling);
            
            videoFileInput.addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    // Create a mock drop event
                    const mockDropEvent = {
                        preventDefault: () => {},
                        dataTransfer: {
                            files: [file]
                        }
                    };
                    
                    // Use the existing drop handler
                    videoDropzone.dispatchEvent(new DragEvent('drop', mockDropEvent));
                }
            });
        }
        
        // Initialize file input support
        window.addEventListener('DOMContentLoaded', addFileInputSupport);
    </script>

</body>
</html>
